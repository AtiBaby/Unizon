<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/default.xhtml">
	<ui:define name="title">#{loginController.user.name}</ui:define>

	<ui:define name="fullBody">
		<p:growl id="messages" life="4000" showDetail="true" />
		<center>
			<h:form id="userform" rendered="#{loginController.loggedIn}">
				<p:tabView>
			        <p:tab title="User information">
			        	<p:panelGrid>
			        		<p:commandButton action="/user/edit_phone_number.jsf" value="Add new phone number">
								<f:param name="phoneNumberId" value="0" />
			        		</p:commandButton>
			        		<p:commandButton action="/user/edit_address.jsf" value="Add new address">
			        			<f:param name="addressId" value="0" />
			        		</p:commandButton>
			        		<p:commandButton action="/user/change_password.jsf" value="Change password" />
			        	</p:panelGrid>
			            <p:panelGrid columns="2" style="text-align: center">
							<p:outputLabel value="Name:" />
							<p:outputLabel value="#{loginController.user.name}" />
							
							<p:outputLabel value="Username:" />
							<p:outputLabel value="#{loginController.user.username}" />
							
							<p:outputLabel value="E-Mail:" />
							<p:outputLabel value="#{loginController.user.EMail}" />
							
							<p:outputLabel value="Registration date:" />
							<p:outputLabel value="#{loginController.user.registrationDate}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</p:outputLabel>
							
							<p:outputLabel value="Has admin rights:" />
							<p:outputLabel value="#{loginController.administrator}" />
							
							<p:outputLabel value="Phone Numbers:" />
							<p:panel>
								<h:dataTable
									value="#{loginController.user.phoneNumbers}"
									var="phoneNumber"
									styleClass="address-table"
					    			headerClass="address-table-header"
					    			rowClasses="address-table-odd-row,order-table-even-row">
									<h:column>
										<f:facet name="header">Phone Number</f:facet>
										<p:outputLabel value="#{phoneNumber.phoneNumber}" />
									</h:column>
									<h:column>
										<f:facet name="header">Edit</f:facet>
										<h:commandLink action="/user/edit_phone_number.jsf" value="Edit">
											<f:param name="phoneNumberId" value="#{phoneNumber.phoneNumberId}" />
										</h:commandLink>
									</h:column>
									<h:column>
										<f:facet name="header">Delete</f:facet>
										<h:commandLink action="#{phoneNumberController.removePhoneNumberFromUser()}" value="Remove">
											<f:param name="phoneNumberId" value="#{phoneNumber.phoneNumberId}" />
										</h:commandLink>
									</h:column>
								</h:dataTable>
							</p:panel>
							
							<p:outputLabel value="Addresses:" />
							<p:panel>
								<h:dataTable
									value="#{loginController.user.addresses}"
									var="address"
									styleClass="address-table"
					    			headerClass="address-table-header"
					    			rowClasses="address-table-odd-row,order-table-even-row">
									<h:column>
										<f:facet name="header">Country</f:facet>
										<p:outputLabel value="#{address.country}" />
									</h:column>
									<h:column>
										<f:facet name="header">Zip</f:facet>
										<p:outputLabel value="#{address.zip}" />
									</h:column>
									<h:column>
										<f:facet name="header">City</f:facet>
										<p:outputLabel value="#{address.city}" />
									</h:column>
									<h:column>
										<f:facet name="header">Street</f:facet>
										<p:outputLabel value="#{address.street}" />
									</h:column>
									<h:column>
										<f:facet name="header">Street Number</f:facet>
										<p:outputLabel value="#{address.strNumber}" />
									</h:column>
									<h:column>
										<f:facet name="header">Floor</f:facet>
										<p:outputLabel value="#{address.floor}" />
									</h:column>
									<h:column>
										<f:facet name="header">Door</f:facet>
										<p:outputLabel value="#{address.door}" />
									</h:column>
									<h:column>
										<f:facet name="header">Edit</f:facet>
										<h:commandLink action="/user/edit_address.jsf" value="Edit">
											<f:param name="addressId" value="#{address.addressId}" />
										</h:commandLink>
									</h:column>
									<h:column>
										<f:facet name="header">Delete</f:facet>
										<h:commandLink action="#{addressController.removeAddress()}" value="Remove">
											<f:param name="addressId" value="#{address.addressId}" />
										</h:commandLink>
									</h:column>
								</h:dataTable>
							</p:panel>
						</p:panelGrid>
			        </p:tab>
			        <p:tab title="Previous orders">
							<p:panel>
								<h:dataTable value="#{loginController.user.orders}" var="order" border="1" styleClass="address-table"
					    			headerClass="address-table-header" rowClasses="address-table-odd-row,order-table-even-row">
									<h:column>
					    					<f:facet name="header">Order Date</f:facet>
											<center><p:outputLabel value="#{order.orderDate}" /></center>
									</h:column>
									<h:column>
										<f:facet name="header">Order Properties</f:facet>
									<h:dataTable value="#{order.prodToOrders}" var="prodtoorder" border="0"
										styleClass="address-table"
					    				headerClass="address-table-header"
					    				rowClasses="address-table-odd-row,order-table-even-row">
					    				<h:column>
					    					<f:facet name="header">Your order amount</f:facet>
											<center><p:outputLabel value="#{prodtoorder.amount}" /></center>
										</h:column>
										<h:column>
											<f:facet name="header">Product title</f:facet>
											<center><p:outputLabel value="#{prodtoorder.product.title}" /></center>
										</h:column>
										<h:column>
											<f:facet name="header">Price</f:facet>
											<center><p:outputLabel value="#{prodtoorder.product.price} Ft" /> </center>
										</h:column>
										<h:column>
											<f:facet name="header">Description</f:facet>
											<center><p:outputLabel value="#{prodtoorder.product.description}" /></center>
										</h:column>
										<h:column>
											<f:facet name="header">You paid</f:facet>
											<center><p:outputLabel value="#{(prodtoorder.product.price)*(prodtoorder.amount)}  Ft" /></center>
										</h:column>
									</h:dataTable>
									<center><p:outputLabel value="Billing address: #{order.address2.zip} #{order.address2.country}, 
									#{order.address2.city}, #{order.address2.street}, #{order.address2.strNumber}">
									</p:outputLabel></center>
									<center><p:outputLabel value="Shipping address: #{order.address1.zip} #{order.address1.country}, 
									#{order.address1.city}, #{order.address1.street}, #{order.address1.strNumber}">
									</p:outputLabel></center>
									<center><p:outputLabel value="Your have paid so far #{loginController.orderPrice[order.orderId]} HUF.">
									</p:outputLabel></center>
									</h:column>
								</h:dataTable>
							</p:panel>
			        </p:tab>
			    </p:tabView>
				<br />
			</h:form>
		</center>
	</ui:define>
</ui:composition>
