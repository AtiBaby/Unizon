<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/default_user.xhtml">

	<ui:define name="custom_css">
		<h:outputStylesheet name="css/admin.css" />
		<h:outputStylesheet name="css/def.css" />
	</ui:define>

	<ui:define name="custom_js">
	</ui:define>

	<ui:define name="fullBody">
		<div id="tab_container" class="container">
			<p:dataTable id="cartDataTable"
				value="#{cartItemController.products.entrySet()}" var="cart">

				<f:facet name="header">
				Products
			</f:facet>

				<p:column class="prod_title" headerText="Title">
					<h:outputText class="prod_celltext" value="#{cart.key.title}" />
				</p:column>

				<p:column class="prod_price" headerText="Price">
					<h:outputText class="prod_celltext" value="#{cart.key.price}" />
				</p:column>

				<p:column class="prod_description" headerText="Description">
					<h:outputText class="prod_celltext" value="#{cart.key.description}" />
				</p:column>

				<p:column class="prod_amount" headerText="Amount">
					<h:outputText class="prod_celltext" value="#{cart.value}" />
				</p:column>

				<p:column class="prod_edit">
					<div class="address_cell">
						<h:form>
							<p:remoteCommand name="editProductInCartRemoteCommand"
								actionListener="#{cartController.editProductInCartListen}"
								update="editProductInCartDialog"
								oncomplete="PF('editProductInCartDialogVar').show()" />
							<a id="edit_product_in_cart_trigger" rel="leanModal"
								data-toggle="modal" data-id="#{cart.key.productId}"
								onclick="editProductInCartRemoteCommand([{name:'productId', value:#{cart.key.productId}},{name:'productAmount', value:#{cart.value}}]);">
								<i class="fa fa-edit"></i>
							</a>
						</h:form>
					</div>
				</p:column>

				<p:column class="prod_remove" rendered="#{not product.deleted}">
					<div class="address_cell">
						<h:form transient="true" id="removeProductFromCartForm">
							<p:remoteCommand name="removeProductFromCartRemoteCommand"
								actionListener="#{cartController.removeProductFromCart}"
								process="@this" oncomplete="location.reload();" />
							<p:commandLink id="remove"
								onclick="removeProductFromCartRemoteCommand([{name:'productId', value:#{cart.key.productId}}]);">
								<f:ajax render="@form" />
								<i class="fa fa-remove"></i>
								<p:confirm header="Delete product" message="Are you sure?"
									icon="ui-icon-alert" />
							</p:commandLink>
							<p:confirmDialog global="true" showEffect="fade"
								hideEffect="fade">
								<p:commandButton value="Yes" type="button"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="No" type="button"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>
						</h:form>
					</div>

				</p:column>

			</p:dataTable>
			<p:commandButton type="button" value="Check out"
				rendered="#{cartController.isCartNotEmpty()}"
				style="margin:5px; float: right;"
				actionListener="#{cartController.checkOut()}" update=":messages" />

		</div>

		<p:dialog header=" Edit
				amount" resizable="false"
			draggable="false" styleClass="address_modal"
			id="editProductInCartDialog" closeOnEscape="true" modal="true"
			widgetVar="editProductInCartDialogVar">
			<div class="login_form_container">
				<h:form id="editProductInCartDialogForm" class="login_form">
					<p:outputLabel value="Amount:" for="minMax" styleClass="required" />
					<p:spinner id="minMax"
						value="#{cartController.selectedProductAmount}" min="1"
						max="#{cartController.selectedProduct.amount}"
						style="padding-right:10px;" />
					<p:commandButton class="button cart" value="Apply"
						oncomplete="PF('editProductInCartDialogVar').hide()"
						actionListener="#{cartController.editProductInCart}"
						update=":messages">
						<!-- 						<i class="fa fa-cart-plus fa-lg" aria-hidden="true"></i> -->
					</p:commandButton>
				</h:form>
			</div>
		</p:dialog>
	</ui:define>
</ui:composition>